var messages=[];var socket;var tabActive=false;var isActiveUser=false;var lastActiveTime;function renderChat(e,b){if(e===""){return}var a="Anonymous";var c=' <div class="row chatParent"> <div class="well well-sm anonymous"><div class="col-xs-3">  <!--span>Anonymous</span--><img src="./images/manager.png" class="img-circle" style="height:30px; width:30px;"> </div> <div class="col-xs-9"> <strong class="msgdiv">'+e+"</strong></div></div></div>";if(b=="right"){c='  <div class="row chatParent"><div class=" well well-sm you"> <div class="col-xs-9"> <strong class="msgdivYou">'+e+'</strong></div><div class="col-xs-2">  <img src="./images/employee.png" class="img-circle" style="height:30px; width:30px;"> <!--span>You</span--></div> </div></div>'}else{if(tabActive===false){c+='<audio src="./sound/ping.mp3" autoplay></audio>'}}$("#cid").append(c);$("html, body").animate({scrollTop:$(document).height()},1000)}function sendToServer(){var b=$("#msg").val();b=b.trim();$("#msg").val("");if(b===""){return}renderChat(b,"right");socket.emit("send",{message:encodeURIComponent(b)});isActiveUser=true;lastActiveTime=new Date().getTime()}function sendMsg(a){if(a.keyCode==13){sendToServer();return false}}$(window).blur(function(){tabActive=false});$(window).focus(function(){tabActive=true});function meStillActive(){if(isActiveUser){var a=new Date().getTime();console.log(a-lastActiveTime);if(a-lastActiveTime>5000*60){console.log("No activity from long time");isActiveUser=false}}}(function(){$("#myModal").modal({keyboard:false});messages=[];socket=io.connect();$("#myModal").modal("hide");$("#app").show();socket.on("message",function(a){if(a.message){messages.push(a.message);renderChat(decodeURIComponent(a.message),"left")}else{console.log("There is a problem:",a)}});socket.on("status",function(a){if(a==="0"){meStillActive();if(isActiveUser){location.reload()}else{socket.disconnect();$("#status").addClass("alert-warning").removeClass("alert-info").removeClass("alert-success");$("#status")[0].innerHTML="<strong>Reload manually to connect.</strong> Happy chatting";$("html, body").animate({scrollTop:0},1000)}}else{if(a==="1"){}else{if(a==="2"){$("#status").addClass("alert-success").removeClass("alert-info").removeClass("alert-warning");$("#status")[0].innerHTML="<strong>User connected.</strong> Start chatting"}}}});$("#send").on("click",function(){sendToServer()})}());